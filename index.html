<html lang="zh-cn">

<head>
    <meta name="viewport" content="initial-scale=1, user-scalable=0, minimal-ui" charset="UTF-8">
    <title>Arxiv One</title>
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./dist/dropload.min.js"></script>
    <link rel="stylesheet" href="./dist/page.css">
    <link rel="stylesheet" href="./dist/dropload.css">
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <input type="search" class="form-control" placeholder="Search(Not implemented)">
                <br>
                <div class="content">
                    <div class="lists"></div>
                </div>
            </div>
            
        </div>
     </div>

</body>
<script>
    $(function(){
    // start_index
    var start_index = 0;
    // 每页展示5个
    var size = 5;

    // dropload
    $('.content').dropload({
        scrollArea : window,
        loadDownFn : function(me){
            // 拼接HTML
            var result = '';
            $.ajax({
                url: "http://export.arxiv.org/api/query?search_query=all:cs.CL&id_list=&start="
                    +start_index+"&max_results="+size
                    +"&sortBy=lastUpdatedDate",
                dataType: "xml",
                success: function(data){
                    entries = $(data).find("entry");
                    start_index += entries.length;
                    if(entries.length > 0){
                        $(data).find("entry").each(function(index,elem){
                            var title = $(elem).find('title').text();
                            var summary = $(elem).find('summary').text();
                            var date = $(elem).find('updated').text().replace("T"," ").replace("Z"," ");
                            var name = $(elem).find('author');
                            var strname = '';
                            name.each(function(index,item){
                                strname += $(item).find('name').text();
                                if(index!=name.length-1){
                                    strname += ', '
                                }
                            })
                            var link = $(elem).find('id').text();
                            result += '<div class="item opacity">' +
                                "<h3>" + title + "</h3>" +
                                "<p class='date'>" + date + "\n" + strname + "</p><br>" +
                                "<p>" + summary + "</p>" +
                                "<a class='origin' href='" + link + "'>more</a>" +
                                "</div>";
                        })
                    }else{
                        // 锁定
                        me.lock();
                        // 无数据
                        me.noData();
                    }
                    // 为了测试，延迟1秒加载
                    setTimeout(function(){
                        // 插入数据到页面，放到最后面
                        $('.lists').append(result);
                        // 每次数据插入，必须重置
                        me.resetload();
                    },500);
                },
                error: function(xhr, type){
                    alert('Ajax error!');
                    // 即使加载出错，也得重置
                    me.resetload();
                }
            });
        }
    });
    });

</script>
</html>
